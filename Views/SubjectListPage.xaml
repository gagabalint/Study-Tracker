<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:StudyTracker.ViewModels"
             xmlns:models="clr-namespace:StudyTracker.Models"
             x:Class="StudyTracker.SubjectListPage"
             x:DataType="viewmodels:SubjectListViewModel"
             Title="My Subjects"
             Loaded="OnLoaded">
    <Grid RowDefinitions="Auto, *" RowSpacing="10" Padding="10">

        <HorizontalStackLayout Grid.Row="0" Spacing="10" HorizontalOptions="Center">
            <Button Text="New Subject" Command="{Binding AddNewSubjectCommand}" />
            <Button Text="Edit" Command="{Binding EditSubjectCommand}"/>
            <Button Text="Delete" Command="{Binding DeleteSubjectCommand}" />
            <Button Text="Summary" Command="{Binding GoToSummaryCommand}" />
        </HorizontalStackLayout>

        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Subjects}"
                        SelectionMode="Single"
                        SelectedItem="{Binding SelectedSubject}">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Subject">

                    <Frame Padding="10" Margin="5" CornerRadius="10" 
                           BackgroundColor="White">

                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer 
                                Command="{Binding BindingContext.SelectSubjectCommand, Source={RelativeSource AncestorType={x:Type CollectionView}}}"
                                CommandParameter="{Binding .}"/>
                        </Frame.GestureRecognizers>
                        <VisualStateManager.VisualStateGroups>
                            
                            
                        </VisualStateManager.VisualStateGroups>

                        <Grid ColumnDefinitions="*, Auto, Auto" ColumnSpacing="10">

                            <Label Grid.Column="0"
                                   Text="{Binding Name}" 
                                   FontSize="Medium" 
                                   FontAttributes="Bold"
                                   VerticalOptions="Center"/>

                            <Button Grid.Column="1"
                                    Text="Jegyek"
                                    FontSize="Small"
                                    Padding="10,5"
                                    MinimumHeightRequest="0" 
                                    Command="{Binding BindingContext.GoToGradesCommand, Source={RelativeSource AncestorType={x:Type CollectionView}}}"
                                    CommandParameter="{Binding .}"/>

                            <Button Grid.Column="2"
                                    Text="Tananyag"
                                    FontSize="Small"
                                    Padding="10,5"
                                    MinimumHeightRequest="0"
                                    Command="{Binding BindingContext.GoToMaterialsCommand, Source={RelativeSource AncestorType={x:Type CollectionView}}}"
                                    CommandParameter="{Binding .}"/>

                        </Grid>
                    </Frame>

                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>